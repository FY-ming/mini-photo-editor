[TOC]
# 开发日志

## 项目概述
**项目名称**：简易修图 App  
**开发周期**：2025年11月20日 - 2025年12月4日  
**核心功能**：主页 → 图片选择 → OpenGL渲染 → 裁剪编辑 → 导出保存  
**技术栈**：Kotlin, OpenGL ES 3.0, MediaStore, Coroutines, Jetpack Components  

---

## 开发时间线

### 2025.11.20 - 项目启动日

#### 今日成就
- 配置基础开发环境
- 调试环境搭建及问题解决

#### 遇到的问题
##### MuMu模拟器ADB连接问题
**问题**：`adb connect` 失败，提示"计算机积极拒绝"

**解决**：次日重启电脑，重启模拟器后恢复正常

**根本原因**：模拟器虚拟网络连接异常

**收获**：理解了ADB客户端-服务器架构，掌握了模拟器网络问题的标准排查流程、adb使用流程。



### 2025.11.21 -正式动工

#### 今日成就
- 创建GitHub仓库并初始化项目结构
- README文件初始化
- 学习GitHub仓库规范、项目文件规范、README书写技巧
- 创建开发问题记录文档
- 初始化本地git仓库

#### 技术决策
**仓库结构设计**：
```
mini_photo_editor/
├── app/
├── gradle/
├── .gitignore
├── README.md
└── LICENSE
```

### 2025.11.22 -跟进 项目正式开始code前的架构思考 

#### 今日成就 
- 文件创建与架构设计 
- 软件核心功能的确定以及具体用户使用流程的梳理

##### 项目架构设计思考
**最初的困惑**:
- 一开始我对项目架构很迷茫： 
- 应该先写代码还是先设计架构？ 
- 各个模块之间应该如何通信？ 
- 数据应该如何在界面间传递？

但考虑到之前的经验，如果使用不成熟的架构实现程序的雏形，后续在其上更改时可谓是难于登天。所以我打算在正式开工code前，先决定自己应该如何完成这个项目。

在思考与学习的过程中，我了解到了很多更加成熟的思想： **模块化分离的认知过程：**
- 最初：觉得所有代码放在一起也可以工作
- 问题：意识到后期维护会变得困难
- 解决方案：按功能划分包结构，即使当前有些包是空的

##### MVVM架构的理解：
- 为什么选择MVVM？因为它是Android官方推荐的现代架构
- 与MVP的区别：ViewModel自动处理生命周期，减少内存泄漏风险
- 实际应用：为每个界面创建对应的ViewModel，即使暂时没有数据逻辑

#### 技术选型的实际考量
##### OpenGL ES的选择：
- 真实原因：项目要求中明确提到需要OpenGL ES渲染
- 学习成本：知道这是个挑战，但愿意尝试
- 备选方案：如果OpenGL太难，后期可以降级到Canvas实现基础功能
##### MediaStore的决策：
- 选择原因：这是访问系统相册的标准方式
- 担忧：知道有厂商兼容性问题需要处理
- 计划：先实现基础功能，再逐个解决适配问题

#### 关于技术债务的考虑
创建了很多暂时用不到的空类文件，这是有意为之：
- 为未来功能预留了明确的扩展点
- 避免了后期大规模重构的风险
- 虽然当前代码看起来"臃肿"，开发之初还未完全清晰各个模块的功能划分，主观上感觉非常混乱，但架构更清晰

创建了：

- data 模型和仓库类 → 为数据管理做准备
- editor/export 等界面文件 → 为后续界面开发做准备
- utils → 为工具函数做准备

这些文件现在看起来是"超前设计"，但目的是：
1. 建立清晰的项目结构
2. 避免后期大规模重构
3. 明确每个模块的职责边界

虽然现在起步阶段这么多空文件堆在一起很头疼，但是我觉得收益还是更大的，它们能更好帮助我在开发过程中不断思考现在的设计是否合理。

#### app核心功能与用户使用流程梳理
##### 核心功能
为了不是盲目摸索产品的ui，我参考了包括醒图在内的若干修图软件的界面设计，最终整理了一份我的小型修
图app最基本的界面设计需求：
1. 作为修图软件，它应该实现最起码的修图功能。这边我的想法是它的界面和市面上的修图软件可以是类
似的： 整个app的下方应该有个按钮栏可以选择主页、其他拓展功能（软件社区之类）、我的（用户信
息），这几个界面来回切换
2. 然后，整个软件的基本功能我认为，最基础的：
   1. 能在主页打开相册
   2. 从相册页选取照片
   3. 能对照片修图
   4. 能导出修图后的图片

##### app设计结构：
**底部导航栏结构** [首页] - [其他功能（P图/社区）] - [我的/帮助]
**核心功能流程：** 首页 → 相册 → 选择照片 → P图界面 → 导出
**用户完整流程** 打开App → 首页点击[选择照片] → 相册选择图片 → 编辑器进行修图 → 点击保存 → 自动导出到相册 → 返回首页

整理完整个app的基本功能的执行流程，**最终我确认了自己第一版的最小任务集。**

##### 第一版本核心功能清单

**必须完成的功能：**
1. 首页 → 相册入口 + 最近编辑记录
2. 相册 → 图片选择
3. 编辑器 → 基础渲染 + 1个编辑功能（建议裁剪）
4. 导出 → 保存到相册


### 2025.11.23 - UI 界面设计

为了设计出更合理的系统架构，我决定先完成项目界面的初步设计，再跟进系统设计的细节。最终结合此前梳理的核心功能，稳步推进界面优化工作。

#### 设计思路演进

**UI 设计的思考过程**

**问题 1：底部导航应该包含哪些页面？**

- 思考：
    - 仅放置 “首页” 会让界面显得单薄，缺乏产品完整性；
    - 放置过多功能则会大幅增加开发压力，不符合起步阶段的节奏；
    - 参考各类修图软件的设计逻辑，最终确定底部导航结构：首页（核心）+ 其他（扩展）+ 我的（用户信息）。
- 结论：既体现产品完整性，又为未来功能拓展预留空间。

**问题 2：首页应该包含什么内容？**

- 思考：
    - 仅保留 “选择照片” 按钮过于简单，缺乏基础交互性；
    - 加入过多编辑功能则偏离 “从相册选择照片” 的核心流程，导致起步阶段开发任务过于复杂；
    - 最终决定：首页突出 “选择照片” 主操作按钮 + 最近编辑记录模块。
- 结论：既保证界面简洁性，又完成首页最基础的设计落地，保留后续修改和拓展的灵活性。

#### 遇到的问题及解决

**问题 1：资源链接失败**

- 现象：编译报错，提示找不到 dimen 资源（header\_height）；
- 原因分析：XML 布局中引用了`header_height`，但`dimens.xml`文件未定义该属性，属于 “想当然” 的疏漏；
- 解决：系统性检查所有资源引用，补全缺失的`dimen`定义；
- 教训：编写布局文件时需同步更新资源文件，避免只写引用不补定义的半拉子操作。

**问题 2：MainActivity 类找不到**

- 现象：App 闪退，抛出`ClassNotFoundException`；
- 根本原因：调整 MainActivity 文件路径后，`AndroidManifest.xml`中声明的 Activity 路径与实际包名不匹配（声明路径为`.MainActivity`，实际路径为`com.example.mini_photo_editor.ui.MainActivity`），包结构层次未在配置中体现；
- 解决：在`AndroidManifest.xml`中补充 MainActivity 的完整包路径；
- 收获：理解 Android 组件注册的包名解析规则，明确配置文件与实际代码路径一致性的重要性。

#### 设计决策背后的思考

**为什么选择当前的首页布局？** 
最初想设计功能丰富的首页，但结合项目定位（小型修图软件 Demo）
**反思：**
产品核心价值是 “修图” 功能，而非 “首页展示”；用户打开 App 的核心诉求是处理照片，而开发的优先级也应聚焦核心功能落地。因此首页需尽可能简洁，快速引导用户进入 “选择照片→修图” 的核心流程。

#### 界面设计的反思

当前首页虽具备基本功能框架，但视觉效果存在明显不足：

- 缺乏现代感和品牌识别度；
- 布局扁平化，无层次感和视觉美感；
- 主操作按钮（选择照片）不够突出。

#### 下一步改进方向：

1. 优化主页视觉体验，同步推进其他页面的设计；
2. 完成相册界面和编辑界面的核心布局设计；
3. 明确产品界面的主题风格（色彩、字体、控件样式等）。

### 2025.11.25 - 梳理开发路线，核心功能开发

#### 梳理开发路线
在完成初步的产品雏形后，我陷入到新的设计难题中：我的项目接下来应该如何推进？

考虑到实现难度和我的项目的核心需求，最终确定路线：
**本地核心功能 → UI美化 → 网络功能**

优先证明产品功能可行性，再到用户观感体验优化，最后再考虑更长远的联网功能或者其他细节优化。

#### 核心功能开发
##### 具体内容梳理
都说核心功能了，那就实现如果用户完全进行合法操作时可以完成修图导出操作，具体功能如下：
1. 打开应用，主页的相册（选择照片）按钮可以交互。
2. 点击这个按钮可以跳转进入相册页。
   1. 注意实现相册页的ui设计
   2. 完成最基本的布局设计和滑动、选取功能
3. 在相册页选择完照片后（暂时只实现选择一张的情况，保留以后批量处理的可能），跳转到编辑页开始修图
   1. 注意完成编辑页ui设计
   2. 拟定暂时的各个修图功能的组件布局设计
4. 实现至少一项修图功能
   1. 拟定后期可能需要实现的修图功能
5. 实现导出功能，图片可以本地永久化

##### 数据流动设计
首页 -(空)→ 相册页 -(Uri)→ 编辑页 -(Bitmap处理)→ 导出

**关键决策：使用 Uri 传递而非 Bitmap**
- 避免大图片内存传输
- 支持后续的大图处理
- 符合Android最佳实践

### 2025.11.28 - 界面优化与用户体验提升

#### 重要改进

- 将相册页从普通Fragment改为**全屏DialogFragment**
- 解决了底部导航栏在相册页依然可操作的不合理体验
- 修复了返回按钮在白色背景下的可见性问题

#### 技术实现

- 使用`DialogFragment` + 全屏样式实现模态对话框
- 相册页现在只能通过返回按钮或系统返回键退出
- 优化了图标对比度

#### 用户体验提升

- 相册页现在以**覆盖层**形式显示，视觉焦点更集中
- 避免了用户误操作底部导航导致流程中断
- 符合现代App的模态交互设计规范

#### 当前状态

- [x]  首页 → 相册页跳转正常  
- [x]  相册页模态体验完整  
- [x]  返回操作流畅  
- [x]  相册图片加载  
- [ ]  编辑器功能（后续开发）

#### 插曲
由于 git 回滚操作，导致 DEVELOPMENT 内容意外丢失，开发记录需要重新提交和备份。在重新整理后，基本恢复开发记录，将DEVELOPMENT文件单独进行一次提交，防止再一次出现回滚导致的内容丢失。


### 2025.11.29 - 阶段性提交 - 相册功能完成，编辑器基础搭建

#### 今日成就
- 完成动态权限管理和相册图片加载
- 搭建 OpenGL ES 基础环境
- 编辑器功能开发中

#### 遇到的问题及解决

##### 问题 1：VSCode记录异常导致开发日志丢失

**现象**：使用VSCode编写DEVELOPMENT.md 文件时未打开项目文件夹导致进度与实际更新不匹配造成内容丢失

**原因分析**：
1. 未及时保存修改到正确位置
2. 多个 IDE 同时操作同一项目导致文件同步混乱

**解决方案**：
1. 立即备份当前的 DEVELOPMENT.md 文件
2. 将 DEVELOPMENT.md 文件单独进行一次提交
3. 添加提交说明："本次更新仅提交DEVELOPMENT防止再次回滚导致开发日志消失"
4. 后续重要修改都先单独提交文档文件
5. vscode编辑文件在项目文件夹中进行

##### 问题 2：权限弹窗失效
**现象**：虽然设计了权限弹窗，但是并没有实际作用

**原因分析**：
1. 权限检查逻辑条件判断有误
2. ActivityResultLauncher 未正确初始化
3. 生命周期问题导致权限请求时机不当

**解决方案**：
1. 修正权限检查逻辑
2. 确保在视图创建后检查权限


##### 问题 3：权限请求流程不完整

**现象**：权限弹窗能显示，但权限授予后数据未加载

**原因分析**：权限回调函数中缺少数据加载触发逻辑

**解决方案**：添加数据加载逻辑

#### 设计决策背后的思考

**为什么使用测试数据作为回退方案？**

- **用户体验考虑**：即使权限被拒绝，用户仍能看到示例界面，了解应用功能
- **开发效率考虑**：在开发初期可以快速验证界面布局
- **学习目的考虑**：让开发者在没有真实照片时也能测试功能

**权限管理的重要性**：

- Android 10 以上版本对存储权限管理更加严格
- 不同厂商设备可能有不同的权限弹窗行为
- 需要为权限拒绝提供优雅的降级方案

#### 当前状态

- 相册页能显示测试图片
- 权限请求功能基本完成
- OpenGL ES 环境搭建
- 图片从相册到编辑器的完整流程（开发中）
- 编辑器的实际渲染功能（开发中）

#### 技术实现的反思

**MediaStore 查询的复杂性**：

1. 需要处理不同 Android 版本的差异
2. 需要考虑厂商定制带来的兼容性问题
3. 异步查询需要妥善管理生命周期

**OpenGL ES 的学习挑战**：

- 概念抽象：纹理、着色器、矩阵变换等概念需要时间理解
- 调试困难：OpenGL 错误通常难以定位
- 资源管理：需要手动管理纹理、缓冲区等资源

### 2025.11.30 - 权限管理与相册真实数据加载

#### 今日成就

- 完善相册加载功能，实现显示真实照片的功能
- 完成权限弹窗功能（选择部分照片无效）
- 解决权限请求和数据加载的连接问题

#### 遇到的问题及解决

##### 问题 1：权限弹窗显示但功能不完整

**现象**：权限弹窗能显示，但"选择部分照片"选项无效，且权限授予后相册数据仍未加载。

**原因分析**：
1. Android 13+ 的"选择部分照片"权限需要特殊处理
2. 权限回调后未正确触发数据重新加载
3. 生命周期管理导致回调执行异常

#### 设计决策背后的思考

##### 为什么接受"选择部分照片"功能不完整？

**技术限制**：

1. Android 13+ 的部分照片权限需要复杂的文件访问管理
2. 需要处理动态权限授予的每个文件
3. 开发时间有限，优先保证核心功能

**用户友好性**：

1. 当用户选择"选择部分照片"时，应用仍能显示测试数据
2. 提供了基本的功能体验
3. 避免了完全无法使用的糟糕体验


### 2025.12.01 - OpenGL ES渲染引擎与编辑器交互功能

#### 今日成就

- 完善编辑器基础交互功能
    - 实现OpenGL ES图片纹理渲染
    - 添加触摸缩放功能（双指捏合）
    - 修复触摸平移方向，符合用户直觉
    - 添加重置按钮恢复原始状态
- 优化相册→编辑器跳转体验，消除闪烁
- 完善图片加载和错误处理流程

#### 遇到的问题及解决

##### 问题 1：OpenGL ES纹理渲染失败

**现象**：从相册选择图片后，编辑器页面黑屏，无法显示图片。

**原因分析**：

1. Bitmap加载后未正确转换为OpenGL纹理
2. 纹理坐标设置错误
3. 渲染器生命周期与Fragment不匹配

**解决方案**：
1. 确保在正确的线程设置纹理
2. 修复纹理坐标映射

##### 问题 2：触摸平移方向反直觉

**现象**：单指拖动图片时，图片移动方向与手指移动方向相反，不符合用户直觉。

**原因分析**：
1. OpenGL坐标系与屏幕坐标系Y轴方向相反
2. 位移计算未考虑坐标系转换
3. 未正确处理触摸事件的坐标系

**解决方案**：
关键修复：dy取负值，使移动方向符合直觉

##### 问题 3：相册→编辑器跳转闪烁

**现象**：从相册选择图片跳转到编辑器时，会短暂看到主页背景，存在视觉闪烁。

**原因分析**：

1. DialogFragment关闭和打开的时序问题
2. 相册页关闭后，编辑器页打开前有空隙
3. 动画效果不连贯

**解决方案**：
通过修正页面开关时序同时配合延迟完成优化
```kotlin
// 先打开编辑器
editorFragment.show(parentFragmentManager, "editor_dialog")

// 等一帧再关闭相册，避免看到主页
view?.postDelayed({
   dismiss()
}, 50) // 50ms足够
```

### 2025.12.02 - 导出功能实现与图片保存

#### 今日成就
- 完成导出功能，实现图片本地永久化保存
- 创建导出页面预览和确认界面
- 实现系统相册保存功能，支持Android不同版本

#### 遇到的问题及解决
##### 问题：仅保存原图
因为目前编辑页功能尚未实现，所以暂时使用原图代替导出图片用于测试导出功能的可行性。

**解决方案**：
后续实现编辑页功能后将进一步优化导出功能


### 2025.12.03 - 首页优化与自定义View实现

#### 今日成就

- 完成主页轮播页照片的扫光特效（自定义View）
- 完成主页轮播页gif图片展示
- 修正主页轮转页展示媒体类型异常问题
- 修正轮播页初始化直接自动翻页导致的观感异常问题
- 优化首页UI设计，添加多个功能区域

#### 遇到的问题及解决

##### 问题 1：扫光特效实现困难

**现象**：想要实现一个"炫酷"的视觉效果，但不知道如何开始，尝试了几种方案效果都不理想。

**原因分析**：

1. 对自定义View的绘制流程不熟悉
2. 扫光效果的动画和渐变处理复杂
3. 性能优化考虑不足

**解决方案**：
一步步推进特效进度，不断学习特效实现流程，简化实现路径。最终完成可见的特效单元。

##### 问题 2：GIF图片在轮播图中显示异常

**现象**：轮播图尝试加载GIF时，要么不显示，要么只显示第一帧，无法正常播放。

**原因分析**：

1. ImageView默认不支持GIF动画
2. 需要额外的库或自定义实现

**解决方案**：
使用Glide加载GIF，完成对GIF的支持

##### 问题 3：轮播页初始化时直接自动翻页

**现象**：轮播图刚显示时就立即开始自动翻页，用户还没来得及看清内容，体验不好。

**原因分析**：

1. 自动轮播定时器启动时机过早
2. 没有给用户足够的停留时间
3. 初始化逻辑与自动轮播逻辑耦合

**解决方案**：
在轮播器初始化时设置其延迟时间，避免在刚初始化加载时就执行切换

#### 设计决策背后的思考

##### 为什么选择扫光特效作为自定义View？

**视觉效果考虑**：

1. 扫光效果能吸引用户注意力
2. 动态效果让界面更加生动
3. 符合"炫酷"视觉效果的要求

**技术实现可行性**：

1. 使用Paint和Shader可以相对容易实现
2. 动画控制比较简单
3. 性能开销可控

##### 轮播图设计的用户体验思考

**信息展示策略**：

1. **停留时间**：给用户足够时间查看每张图片
2. **手动控制**：允许用户手动滑动查看
3. **指示器**：清晰显示当前位置和总数量
4. **循环播放**：无缝衔接，提升体验

#### 当前状态

- 扫光特效自定义View实现
- 轮播图支持GIF动画播放
- 媒体类型正确识别和显示
- 自动轮播延迟启动，体验优化
- 首页UI重构完成
- 轮播图点击交互（待完善）
- 视频预览功能（待完善）
- 更多自定义View效果（待完善）

### 2025.12.04 - 裁剪功能实现与项目收尾

#### 今日成就

- 增加裁剪功能，实现裁剪框绘制、导入预览、导出功能
- 修正裁剪对应预览显示异常问题，优化裁剪显示
- 添加代码混淆配置，启用R8代码压缩和优化
- 更新README文档，添加项目截图
- 添加签名文件，准备打包可用安装包
- 添加主页滑动功能，优化主页观感

### 遇到的问题及解决

##### 问题 1：裁剪框绘制异常

**现象**：裁剪框绘制时显示位置不正确，或者绘制出来后无法正常拖动调整。

**原因分析**：

1. View坐标与Bitmap像素坐标转换错误
2. 触摸事件处理逻辑有误
3. 裁剪框绘制逻辑与触摸交互未正确关联

**解决方案**：
修正绘制与交互逻辑，保证显示正确

#### 问题 2：裁剪预览显示异常

**现象**：裁剪后的图片在预览中显示不正确，可能显示错位、变形或部分缺失。

**原因分析**：

1. View坐标到Bitmap像素坐标转换错误
2. 裁剪区域计算有误
3. OpenGL纹理更新时机不对

**解决方案**：
在每一次确认裁剪后删除原本图像重新绘制新图片，同时保证同步预览图片的照片信息，确保裁剪导出的结果一致


##### 问题 3：代码混淆导致功能异常

**现象**：启用代码混淆后，应用在某些功能上崩溃，特别是OpenGL相关功能。

**原因分析**：

1. OpenGL渲染器类被混淆
2. Fragment和Activity被错误混淆
3. 数据模型类被混淆导致序列化问题

**解决方案**：
确保第三方的库以及OpenGL相关不被混淆，保证不干扰正常功能

##### 问题 4：主页滑动功能实现困难

**现象**：想要在首页添加滑动功能，但ScrollView嵌套导致布局冲突。

**原因分析**：

1. ScrollView与ViewPager2等控件嵌套冲突
2. 滑动事件处理冲突

**解决方案**：
确保各个组件间的嵌套与约束关系，不要添加多余的约束条件。同时，通过控制组件关系，尽可能优化界面观感。

##### 问题 5：未签名APK安装失败

**现象**：使用Android Studio直接构建的APK在手机上安装时失败，提示"安装包错误"。

**原因分析**：

1. Android系统要求所有APK必须经过数字签名才能安装
2. 调试版本使用调试密钥，但发布版本需要正式签名
3. 未在`build.gradle`中配置签名信息

**解决方案**：
添加签名密钥，重新打包

## 项目总结

经过15天的密集开发，简易修图App从零开始，完成了从架构设计到功能实现的全过程。项目不仅实现了技术要求的所有功能，还在用户体验、代码质量和工程实践方面达到了较高水平。

**核心收获**：

1. 掌握了现代Android开发的完整流程
2. 深入理解了OpenGL ES在移动端的应用
3. 积累了复杂功能模块的设计和实现经验
4. 学会了在时间压力下进行有效的项目管理和技术决策

**未来展望**：

1. 可以继续添加滤镜、文字、贴纸等编辑功能
2. 可以优化性能，支持更大尺寸的图片处理
3. 可以添加云同步和社区分享功能
4. 可以探索AI图片处理的前沿技术